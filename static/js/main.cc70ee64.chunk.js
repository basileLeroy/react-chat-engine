(this["webpackJsonpreact-chat-engine-example"]=this["webpackJsonpreact-chat-engine-example"]||[]).push([[0],{106:function(e,t,a){e.exports=a(269)},107:function(e,t,a){},112:function(e,t,a){},269:function(e,t,a){"use strict";a.r(t);a(107);var n=a(0),s=a.n(n),c=a(20),o=a.n(c),r=(a(112),a(21)),i=a(275),l=a(7),d=a(95),p=Object(d.a)(),m=a(1),h=a(3),u=a(32),g=a.n(u),b=a(6),f=a.n(b),x=a(54),v=a(276),E=a(277),y=a(278),C=a(279),O=a(280),j=a(281),w=a(282),S=a(283),N=a(284),k=a(285),M=a(286),I=a(287),D=a(288),A=a(5),T=a(96);const R=Object(n.createContext)(),z=e=>{const t=Object(n.useState)(!0),a=Object(h.a)(t,2),c=a[0],o=a[1],r=Object(n.useState)(null),i=Object(h.a)(r,2),l=i[0],d=i[1],p=Object(n.useState)(null),m=Object(h.a)(p,2),u=m[0],g=m[1],b=Object(n.useState)({}),f=Object(h.a)(b,2),x=f[0],v=f[1],E=Object(n.useState)({}),y=Object(h.a)(E,2),C=y[0],O=y[1],j=Object(n.useState)(null),w=Object(h.a)(j,2),S=w[0],_=w[1],N=Object(n.useState)({}),k=Object(h.a)(N,2),M=k[0],I=k[1],D=Object(n.useState)({}),A=Object(h.a)(D,2),T={connecting:c,setConnecting:o,conn:l,setConn:d,chats:u,setChats:g,messages:x,setMessages:v,sendingMessages:C,setSendingMessages:O,activeChat:S,setActiveChat:_,typingCounter:M,setTypingCounter:I,typingData:A[0],setTypingData:A[1]};return s.a.createElement(R.Provider,{value:T},e.children)};function F(e){return e&&e.development?"http://127.0.0.1:8000":"https://api.chatengine.io"}function L(e){return e.chatID?{"public-key":e.publicKey?e.publicKey:e.projectID,"chat-id":e.chatID,"access-key":e.chatAccessKey}:{"Public-Key":e.publicKey?e.publicKey:e.projectID,"User-Name":e.userName,"User-Secret":e.userPassword?e.userPassword:e.userSecret}}function P(e,t,a){f.a.get("".concat(F(e),"/chats/").concat(t,"/messages/"),{headers:L(e)}).then(n=>{e.onGetMessages&&e.onGetMessages(t,n.data),a&&a(t,n.data)}).catch(e=>{console.log("Fetch Messages Error",e)})}function B(e,t,a,n){f.a.patch("".concat(F(e),"/chats/").concat(t,"/people/"),{last_read:a},{headers:L(e)}).then(e=>{n&&n(e.data)}).catch(e=>{console.log("Read Message Error",e)})}const K=e=>{const t=Object(n.useContext)(R),a=t.setConnecting,c=t.conn,o=t.setConn,r=t.chats,i=t.setChats,l=t.messages,d=t.setMessages,p=t.sendingMessages,h=t.setSendingMessages,u=t.activeChat,g=t.setActiveChat,b=t.typingCounter,f=t.setTypingCounter;function v(t){if(r){const e=Object(m.a)({},r);e[t.id]=t,i(e)}e.onEditChat&&e.onEditChat(t)}const E=e.development,y=e.publicKey,C=e.projectID,O=e.userName,j=e.userPassword,w=e.userSecret,S=E?"ws://":"wss://",N=E?"127.0.0.1:8000":"api.chatengine.io",k=y||C,M=j||w;return s.a.createElement(x.a,{url:"".concat(S).concat(N,"/person/?publicKey=").concat(k,"&username=").concat(O,"&secret=").concat(M),onOpen:()=>function(t){o(t),a(!1),e.onConnect&&e.onConnect(t)}(e),onClose:function(){a(!0)}.bind(void 0),onMessage:function(t){const a=JSON.parse(t);if("login_error"===a.action)console.log("Your login credentials were not correct: \n\n                Project ID: ".concat(e.projectID," \n\n                Username: ").concat(e.userName," \n\n                User Secret: ").concat(e.userSecret,"\n\n                Double check these credentials to make sure they're correct.\n\n                If all three are correct, try resetting the username and secret in the Online Dashboard or Private API.")),o(void 0),e.onFailAuth&&e.onFailAuth(c);else if("new_chat"===a.action){const t=a.data;if(r){const e=Object(m.a)({},r);e[t.id]=t,i(e),g(t.id)}e.onNewChat&&e.onNewChat(a.data)}else if("edit_chat"===a.action)v(a.data);else if("delete_chat"===a.action){const t=a.data;if(r&&(r[t.id]=void 0,i(r),!_.isEmpty(r))){const e=function(e){return Object.values(e).sort((e,t)=>{const a=e.last_message.created?new Date(e.last_message.created):new Date(e.created),n=t.last_message.created?new Date(t.last_message.created):new Date(t.created);return new Date(n)-new Date(a)})}(r);g(e[0]?parseInt(e[0].id):0)}e.onDeleteChat&&e.onDeleteChat(t)}else if("add_person"===a.action)v(a.data),e.onAddPerson&&e.onAddPerson(a.data);else if("remove_person"===a.action)v(a.data),e.onRemovePerson&&e.onRemovePerson(a.data);else if("new_message"===a.action){const t=a.data,n=t.id,s=t.message;if("string"===typeof s.custom_json&&-1!==s.custom_json.indexOf("sender_id")&&(p[JSON.parse(s.custom_json).sender_id]=void 0,h(p)),n===u){const e=Object(m.a)({},l);e[s.id]=s,d(e)}s.sender_username!==e.userName&&B(c,u,s.id,e=>v(e)),e.onNewMessage&&e.onNewMessage(n,s)}else if("edit_message"===a.action){const t=a.data,n=t.id,s=t.message;n===u&&(l[s.id]=s,d(l)),e.onEditMessage&&e.onEditMessage(n,s)}else if("delete_message"===a.action){const t=a.data,n=t.id,s=t.message;n===u&&(l[s.id]=void 0,d(l)),e.onDeleteMessage&&e.onDeleteMessage(n,s)}else if("is_typing"===a.action){const t=a.data,n=t.id,s=t.person;let c=Object(m.a)({},b);c=c[n]&&c[n][s]?Object(m.a)(Object(m.a)({},c),{},{[n]:Object(m.a)(Object(m.a)({},c[n]),{},{[s]:c[n][s]+1})}):Object(m.a)(Object(m.a)({},c),{},{[n]:Object(m.a)(Object(m.a)({},c[n]),{},{[s]:1})}),f(c),e.onTyping&&e.onTyping(n,s)}}.bind(void 0),reconnectIntervalInMilliSeconds:3e3})};function U(e,t,a){f.a.post("".concat(F(e),"/chats/"),t,{headers:L(e)}).then(e=>{a&&a(e.data)}).catch(e=>{console.log("New Chat Error",e)})}function W(e,t,a){f.a.get("".concat(F(e),"/chats/latest/").concat(t,"/"),{headers:L(e)}).then(t=>{e.onGetChats&&e.onGetChats(t.data),a&&a(t.data)}).catch(e=>{console.log("Fetch Chats Error",e)})}const G=e=>{const t=Object(n.useRef)(),a=function(t){const a=Object(n.useState)(!1),s=Object(h.a)(a,2),c=s[0],o=s[1],r=new IntersectionObserver(([t])=>{o(t.isIntersecting),t.isIntersecting&&e.onVisible()});return Object(n.useEffect)(()=>(r.observe(t.current),()=>{r.disconnect()}),[]),c}(t);return s.a.createElement("div",{ref:t},a&&"Loading...")},H=()=>{const e=Object(n.useContext)(R).conn,t=Object(n.useState)(""),a=Object(h.a)(t,2),c=a[0],o=a[1];return s.a.createElement("form",{onSubmit:function(t){t.preventDefault(),c.trim().length>0&&U(e,{title:c},()=>{}),o("")}.bind(void 0)},s.a.createElement("div",{style:{height:"1px"}},s.a.createElement(at,{label:"New Chat",value:c,style:{width:"calc(100% - 48px)"},handleChange:e=>{o(e.target.value)}})),s.a.createElement("div",{style:{width:"100%",textAlign:"right"}},s.a.createElement(et,{icon:"plus",type:"submit"})))};const J=e=>{const t=Object(n.useContext)(R),a=t.conn,c=t.activeChat,o=t.setActiveChat;const r=e.chat,i=c===r.id?Y.activeChat:{},l=r.people.find(e=>e.person.username!==a.userName);if(e.renderChatCard)return s.a.createElement("div",{key:"chat_".concat(index)},e.renderChatCard(r,index));let d=r.last_message.text;return d||(d=r.last_message.attachments.length>0?"".concat(r.last_message.attachments.length," image").concat(r.last_message.attachments.length>1?"s":""):"Say hello!"),s.a.createElement("div",{onClick:()=>o(r.id),style:Object(m.a)(Object(m.a)({},Y.chatContainer),i),className:"ce-chat-card ".concat(c===r.id&&"ce-active-chat-card")},s.a.createElement("div",{style:Y.titleText,className:"ce-chat-title-text"},r.is_direct_chat&&l?l.person.username:r.title,!function(e){let t=!0;return e.people.map(n=>{a.userName===n.person.username&&(t=e.last_message.id===n.last_read)}),t}(r)&&s.a.createElement("div",{className:"ce-chat-unread-dot",style:{float:"right",width:"12px",height:"12px",borderRadius:"6px",backgroundColor:"#1890ff",display:"inline-block"}})),s.a.createElement("div",{style:{width:"100%"},className:"ce-chat-subtitle"},s.a.createElement("div",{style:Y.messageText,className:"ce-chat-subtitle-text ce-chat-subtitle-message"},d),s.a.createElement("div",{className:"ce-chat-subtitle-text ce-chat-subtitle-date",style:Object(m.a)(Object(m.a)({},Y.messageText),{textAlign:"right",width:"25%"})},function(e){if(!e)return"";const t=e.substr(8,2),a=e.substr(5,2),n=e.substr(0,4);return new Date("".concat(a," ").concat(t," ").concat(n)).toString().substr(4,6)}(r.last_message.created))))},Y={chatContainer:{padding:"16px",paddingBottom:"12px",cursor:"pointer"},titleText:{fontWeight:"500",paddingBottom:"4px",whiteSpace:"nowrap",overflow:"hidden"},messageText:{width:"75%",color:"rgba(153, 153, 153, 1)",fontSize:"14px",whiteSpace:"nowrap",overflow:"hidden",display:"inline-block"},activeChat:{backgroundColor:"#d9d9d9",border:"4px solid white",borderRadius:"12px"}};let X=13;const q=e=>{const t=Object(n.useRef)(!1),a=Object(n.useState)(!0),c=Object(h.a)(a,2),o=c[0],r=c[1],i=Object(n.useContext)(R),l=i.chats,d=i.setChats,p=i.activeChat,u=i.setActiveChat;function b(e){return e.sort((e,t)=>{const a=e.last_message.created?new Date(e.last_message.created):new Date(e.created),n=t.last_message.created?new Date(t.last_message.created):new Date(t.created);return new Date(n)-new Date(a)})}function f(e,t){const a=b(e);a.length>0&&null===p&&u(a[0].id),t&&t>a.length&&r(!1);const n=Object(m.a)({},e);d(g.a.mapKeys(n,"id"))}Object(n.useEffect)(()=>{t.current||(t.current=!0,W(e,13,e=>f(e)))});const x=b(l?Object.values(l):[]);return s.a.createElement("div",{style:V.chatListContainer,className:"ce-chat-list"},s.a.createElement("div",{style:V.chatsContainer,className:"ce-chats-container"},function(t){return t.map((t,a)=>t?e.renderChatCard?s.a.createElement("div",{key:"chat_".concat(a)},e.renderChatCard(t,a)):s.a.createElement("div",{key:"chat_".concat(a),onClick:()=>e.onChatClick&&e.onChatClick()},s.a.createElement(J,{chat:t})):s.a.createElement("div",{key:"chat_".concat(a)}))}(x),o&&x.length>0&&s.a.createElement(G,{onVisible:()=>(X+=13,void W(e,X,e=>f(e,X)))}),s.a.createElement("div",{style:{height:"64px"}}),e.renderNewChatForm?e.renderNewChatForm(e):s.a.createElement("div",{style:V.newChatContainer,className:"ce-chat-form-container"},s.a.createElement(H,{className:"ce-chat-form"}))))},V={chatListContainer:{height:"100%",maxHeight:"100vh",overflow:"scroll",overflowX:"hidden",borderRight:"1px solid #afafaf",backgroundColor:"white"},chatsContainer:{width:"100%",backgroundColor:"white",borderRadius:"0px 0px 24px 24px"},chatContainer:{padding:"16px",paddingBottom:"12px",cursor:"pointer"},titleText:{fontWeight:"500",paddingBottom:"4px",whiteSpace:"nowrap",overflow:"hidden"},messageText:{width:"75%",color:"rgba(153, 153, 153, 1)",fontSize:"14px",whiteSpace:"nowrap",overflow:"hidden",display:"inline-block"},activeChat:{backgroundColor:"#d9d9d9",border:"4px solid white",borderRadius:"12px"},newChatContainer:{position:"absolute",bottom:"0px",padding:"12px",width:"calc(100% - 25px)",backgroundColor:"white"}},Q=e=>{const t=Object(n.useState)(!1),a=Object(h.a)(t,2),c=a[0],o=a[1];return s.a.createElement("div",null,s.a.createElement(v.a,{onClick:()=>o(!0),style:{color:"rgb(24, 144, 255)",outline:"none"}}),c&&s.a.createElement("div",{style:Z.drawerContainer},s.a.createElement(E.a,{style:Z.closeIcon,onClick:()=>o(!1)}),s.a.createElement("div",{style:Z.titleContainer},s.a.createElement("div",{style:Z.titleText},"My Chats")),s.a.createElement(q,Object.assign({},e,{onChatClick:()=>o(!1)}))))},Z={drawerContainer:{position:"fixed",zIndex:"1",top:"0px",left:"0px",width:"100%",height:"100%",backgroundColor:"white",textAlign:"left"},closeIcon:{position:"absolute",left:"28px",top:"32px"},titleContainer:{width:"100%",padding:"24px 0px",textAlign:"center",color:"rgb(24, 144, 255)"},titleText:{fontSize:"24px",fontWeight:"600"}},$=e=>{const t=Object(n.useState)(!1),a=Object(h.a)(t,2),c=a[0],o=a[1];function r(){!function(e,t,a,n){f.a.put("".concat(F(e),"/chats/").concat(t,"/people/"),{username:a},{headers:L(e)}).then(e=>{n&&n(e.data)}).catch(e=>{console.log("Delete Person Error",e)})}(e.conn,e.chat.id,e.person.username)}const i=e.person,l=e.chat,d=e.conn;if(!i||!l)return s.a.createElement("div",null);const p=l.admin;return s.a.createElement("div",{className:"ce-person-container",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1)},s.a.createElement("div",{className:"ce-person-avatar",style:{padding:"2px",height:"0px"}},s.a.createElement(Ze,{avatar:i.avatar,username:i.username,is_online:i.is_online})),s.a.createElement("div",{className:"ce-person-text",style:{paddingLeft:"52px",height:"44px",position:"relative",top:"10px",fontSize:"15px"}},function(e){return e.first_name&&null!==e.first_name?"".concat(e.first_name).concat(e.last_name?" ".concat(e.last_name):""):e.username}(i)),c&&d.userName===p.username&&i.username!==p.username&&s.a.createElement("div",{className:"ce-delete-chat",style:{float:"right",height:"0px",position:"relative",bottom:"44px"}},s.a.createElement(et,{theme:"danger",icon:"delete",onClick:()=>r()})))},ee=e=>{const t=Object(n.useState)(!1),a=Object(h.a)(t,2),c=a[0],o=a[1],r=e.person,i=r.avatar,l=r.username;return s.a.createElement("div",{onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onClick:()=>e.onClick&&e.onClick(),style:Object(m.a)(Object(m.a)({},te.option),{backgroundColor:c?"#f5f5f5":"white"})},s.a.createElement("div",null,s.a.createElement(Ze,{username:l,avatar:i})),s.a.createElement("div",{style:{display:"flex",padding:"12px 4px"}},e.person.username))},te={option:{padding:"4px 16px",cursor:"pointer",fontSize:"15px",display:"flex"}},ae=e=>{const t=Object(n.useState)({value:"",others:[]}),a=Object(h.a)(t,2),c=a[0],o=a[1];function r(){!function(e,t,a,n){f.a.get("".concat(F(e),"/chats/").concat(t,"/others/"),{headers:L(e)}).then(n=>{e.onGetOtherPeople&&e.onGetOtherPeople(t,n.data),a&&a(t,n.data)}).catch(e=>{console.log("Fetch Other People Error",e),n&&n()})}(e.conn,e.chat.id,(e,t)=>o(Object(m.a)(Object(m.a)({},c),{},{others:t})),()=>{})}function i(t){return s.a.createElement(ee,{person:t,onClick:()=>{return a=t.username,void Qe(e.conn,e.chat.id,a,()=>{o(Object(m.a)(Object(m.a)({},c),{},{value:""})),r()});var a}})}return s.a.createElement("div",{style:{marginBottom:"12px"}},s.a.createElement(ot,{style:{width:"100%"},label:"Type a username",value:c.value,options:c.others,onFocus:()=>r(),handleChange:e=>function(e){o(Object(m.a)(Object(m.a)({},c),{},{value:e}))}(e),renderOption:e=>i(e)}))},ne=e=>{const t=Object(n.useState)({collapsed:!1,hovered:!1}),a=Object(h.a)(t,2),c=a[0],o=a[1],r=e.chat;if(r.is_direct_chat)return s.a.createElement("div",null);return s.a.createElement("div",{style:{borderTop:"1px solid #f0f0f0"}},s.a.createElement("div",{onMouseEnter:()=>o(Object(m.a)(Object(m.a)({},c),{},{hovered:!0})),onMouseLeave:()=>o(Object(m.a)(Object(m.a)({},c),{},{hovered:!1})),onClick:()=>o(Object(m.a)(Object(m.a)({},c),{},{collapsed:!c.collapsed})),style:c.hovered?{backgroundColor:"#f0f0f0",cursor:"pointer"}:{},className:"ce-section-title-container ce-person-title-container"},s.a.createElement("div",{className:"ce-section-title ce-people-title",style:{fontSize:"17px",padding:"12px",fontWeight:"600"}},"People"),c.collapsed?s.a.createElement(y.a,{style:se.collapseIcon}):s.a.createElement(C.a,{style:se.collapseIcon})),!c.collapsed&&s.a.createElement("div",null,s.a.createElement("div",{style:{height:"12px"}}),function(t,a){return t.map((t,n)=>s.a.createElement($,{key:"person_".concat(n),person:t.person,conn:e,chat:a}))}(r.people,r),s.a.createElement("div",{style:{height:"12px"}}),e&&r&&e.userName===r.admin.username&&s.a.createElement(ae,{conn:e,chat:r})))},se={collapseIcon:{float:"right",position:"relative",bottom:"30px",right:"12px"}},ce=e=>{const t=e.attachment;return t?s.a.createElement("div",{style:oe.container,className:"ce-photo-thumbnail"},s.a.createElement("div",{style:{paddingTop:"100%"}}),s.a.createElement("img",{alt:t.id,style:oe.image,src:t.file,className:"ce-photo-img",id:"image-".concat(t.id)})):s.a.createElement("div",null)},oe={container:{position:"relative",width:"calc(33% - 8px)",border:"1px solid white",display:"inline-block",cursor:"pointer"},image:{top:"0px",width:"100%",height:"100%",position:"absolute",objectFit:"cover"}},re=e=>{const t=Object(n.useState)({collapsed:!0,hovered:!1}),a=Object(h.a)(t,2),c=a[0],o=a[1],r=e.chat;return s.a.createElement("div",{style:{borderTop:"1px solid #f0f0f0"},className:"ce-photo-section"},s.a.createElement("div",{onMouseEnter:()=>o(Object(m.a)(Object(m.a)({},c),{},{hovered:!0})),onMouseLeave:()=>o(Object(m.a)(Object(m.a)({},c),{},{hovered:!1})),onClick:()=>o(Object(m.a)(Object(m.a)({},c),{},{collapsed:!c.collapsed})),style:c.hovered?{backgroundColor:"#f0f0f0",cursor:"pointer"}:{},className:"ce-section-title-container ce-photo-title-container"},s.a.createElement("div",{className:"ce-section-title ce-photo-title",style:{fontSize:"17px",padding:"12px",fontWeight:"600"}},"Photos"),c.collapsed?s.a.createElement(y.a,{style:ie.collapseIcon}):s.a.createElement(C.a,{style:ie.collapseIcon})),!c.collapsed&&s.a.createElement("div",{className:"ce-photo-feed"},s.a.createElement("div",{style:{height:"12px"}}),r.attachments.map((e,t)=>s.a.createElement(ce,{key:"person_".concat(t),attachment:e}))))},ie={collapseIcon:{float:"right",position:"relative",bottom:"30px",right:"12px"}},le=e=>{const t=Object(n.useState)({collapsed:!0,hovered:!1}),a=Object(h.a)(t,2),c=a[0],o=a[1],r=e.chat;return s.a.createElement("div",{style:{borderTop:"1px solid #f0f0f0"}},s.a.createElement("div",{onMouseEnter:()=>o(Object(m.a)(Object(m.a)({},c),{},{hovered:!0})),onMouseLeave:()=>o(Object(m.a)(Object(m.a)({},c),{},{hovered:!1})),onClick:()=>o(Object(m.a)(Object(m.a)({},c),{},{collapsed:!c.collapsed})),style:c.hovered?{backgroundColor:"#f0f0f0",cursor:"pointer"}:{}},s.a.createElement("div",{style:{fontSize:"17px",padding:"12px",fontWeight:"600"}},"Options"),c.collapsed?s.a.createElement(y.a,{style:de.collapseIcon}):s.a.createElement(C.a,{style:de.collapseIcon})),!c.collapsed&&s.a.createElement("div",null,s.a.createElement("div",{style:{height:"12px"}}),s.a.createElement(et,{value:"Delete",theme:"danger",icon:"delete",onClick:()=>function(e,t,a){f.a.delete("".concat(F(e),"/chats/").concat(t,"/"),{headers:L(e)}).then(e=>{a&&a(e.data)}).catch(e=>{console.log("Delete Chat Error",e)})}(e,r.id,e=>{}),style:{width:"100%",marginBottom:"12px"}})))},de={collapseIcon:{float:"right",position:"relative",bottom:"30px",right:"12px"}},pe=e=>{const t=Object(n.useRef)(!1),a=Object(n.useState)({activeChat:null,value:""}),c=Object(h.a)(a,2),o=c[0],r=c[1];function i(t){t.preventDefault(),function(e,t,a,n){f.a.patch("".concat(F(e),"/chats/").concat(t,"/"),a,{headers:L(e)}).then(e=>{n&&n(e.data)}).catch(e=>{console.log("Edit Chat Error",e)})}(e.conn,e.chat.id,{title:o.value},e=>{})}return Object(n.useEffect)(()=>{t.current?o.activeChat!==e.chat.id&&r(Object(m.a)(Object(m.a)({},o),{},{value:e.chat.title,activeChat:e.chat.id})):t.current=!0}),s.a.createElement("form",{onSubmit:e=>i(e),className:"ce-chat-title-form"},s.a.createElement(at,{label:"Rename this Chat",value:o.value,default:e.chat.title,handleChange:e=>{return t=e,void r(Object(m.a)(Object(m.a)({},o),{},{value:t.target.value}));var t},style:{fontSize:"16px",fontWeight:"600",textAlign:"center",border:"0px solid white",width:"100%"}}))},me=e=>{const t=Object(n.useContext)(R).conn,a=e.chat,c=a.people.slice(0,3),o=a.people.find(e=>e.person.username!==t.userName);function r(e){return s.a.createElement("div",{style:{width:"100%",paddingTop:"14px"}},s.a.createElement("div",{style:{float:"left",position:"relative",left:"calc(50% - 22px)"}},s.a.createElement(Ze,{show_online:!1,username:e[0].person.username,avatar:e[0].person.avatar})))}return s.a.createElement("div",{className:"ce-chat-settings-container"},s.a.createElement("div",{className:"ce-chat-avatars-row"},1===c.length&&r(c),a.is_direct_chat&&o&&r([o]),!a.is_direct_chat&&o&&2===c.length&&function(e){return s.a.createElement("div",{style:{width:"100%",paddingTop:"14px"}},s.a.createElement("div",{style:{float:"left",position:"relative",left:"calc(50% - 22px - 15px)"}},s.a.createElement(Ze,{show_online:!1,username:e[0].person.username,avatar:e[0].person.avatar})),s.a.createElement("div",{style:{float:"left",position:"relative",left:"calc(50% - 44px - 22px + 15px)"}},s.a.createElement(Ze,{show_online:!1,username:e[1].person.username,avatar:e[1].person.avatar})))}(c),!a.is_direct_chat&&o&&3===c.length&&function(e){return s.a.createElement("div",{style:{width:"100%",paddingTop:"14px"}},s.a.createElement("div",{style:{float:"left",position:"relative",left:"calc(50% - 22px - 24px)"}},s.a.createElement(Ze,{show_online:!1,username:e[0].person.username,avatar:e[0].person.avatar})),s.a.createElement("div",{style:{float:"left",position:"relative",left:"calc(50% - 24px - 44px)"}},s.a.createElement(Ze,{show_online:!1,username:e[1].person.username,avatar:e[1].person.avatar})),s.a.createElement("div",{style:{float:"left",position:"relative",left:"calc(50% - 22px - 44px - 44px + 24px)"}},s.a.createElement(Ze,{show_online:!1,username:e[2].person.username,avatar:e[2].person.avatar})))}(c)),a.is_direct_chat&&o?s.a.createElement("div",{style:{paddingTop:"55px",paddingBottom:"7px",fontSize:"16px",fontWeight:"600",textAlign:"center",border:"0px solid white",width:"100%"}},o.person.username):s.a.createElement(pe,{chat:a,conn:t}))},he=e=>{const t=Object(n.useContext)(R),a=t.chats,c=t.activeChat,o=a&&a[c];return o?s.a.createElement("div",{style:ue.settingsContainer,className:"ce-settings"},s.a.createElement("div",{style:{width:"90%",paddingLeft:"5%"},className:"ce-settings-container"},e.renderChatSettingsTop?e.renderChatSettingsTop(e,o):s.a.createElement(me,Object.assign({},e,{chat:o})),e.renderPeopleSettings?e.renderPeopleSettings(e,o):s.a.createElement(ne,Object.assign({},e,{chat:o})),e.renderPhotosSettings?e.renderPhotosSettings(o):s.a.createElement(re,Object.assign({},e,{chat:o})),e&&o&&e.userName===o.admin.username&&s.a.createElement("div",null,e.renderOptionsSettings?e.renderOptionsSettings(e,o):s.a.createElement(le,Object.assign({},e,{chat:o}))))):s.a.createElement("div",{style:ue.filler})},ue={settingsContainer:{height:"100%",overflow:"scroll",overflowX:"hidden",borderLeft:"1px solid #afafaf",backgroundColor:"white"},filler:{display:"flex",width:"90%",paddingLeft:"5%",borderLeft:"1px solid #afafaf"}},ge=e=>{const t=Object(n.useState)(!1),a=Object(h.a)(t,2),c=a[0],o=a[1];return s.a.createElement("div",null,s.a.createElement(O.a,{onClick:()=>o(!0),style:{color:"rgb(24, 144, 255)",outline:"none"}}),c&&s.a.createElement("div",{style:be.drawerContainer},s.a.createElement(E.a,{style:be.closeIcon,onClick:()=>o(!1)}),s.a.createElement("div",{style:be.titleContainer},s.a.createElement("div",{style:be.titleText},"Chat Settings")),s.a.createElement(he,e)))},be={drawerContainer:{position:"fixed",zIndex:"1",top:"0px",left:"0px",width:"100%",height:"100%",backgroundColor:"white",textAlign:"left"},closeIcon:{position:"absolute",left:"28px",top:"32px"},titleContainer:{width:"100%",padding:"24px 0px",textAlign:"center",color:"rgb(24, 144, 255)"},titleText:{fontSize:"24px",fontWeight:"600"}};Object(A.setConfiguration)({maxScreenClass:"xl",gutterWidth:0});const fe=e=>{const t=Object(n.useContext)(R),a=t.conn,c=t.chats,o=t.activeChat;if(!c||!o||!c[o])return s.a.createElement("div",null);const r=c[o],i=r.people.find(e=>e.person.username!==a.userName);return s.a.createElement(A.Row,{className:"ce-chat-title",style:xe.titleSection},s.a.createElement(A.Col,{xs:2,sm:0,style:Object(m.a)(Object(m.a)({},xe.mobileOptiom),{left:"6px"}),className:"ce-chat-list-mobile-option"},s.a.createElement(Q,null)),s.a.createElement(A.Col,{xs:8,sm:12,style:xe.titleContainer,className:"ce-chat-title-container"},s.a.createElement("div",{style:xe.titleText,className:"ce-chat-title-text"},r.is_direct_chat&&i?i.person.username:r.title),s.a.createElement("div",{style:xe.subtitleText,className:"ce-chat-subtitle-text"},r.last_message.created&&r.last_message.created.length>0?"Active ".concat(function(e){if(!e)return"";const t=e.substr(8,2),a=e.substr(5,2),n=e.substr(0,4),s=e.substr(11,2),c=e.substr(14,2),o=e.substr(17,2);var r=new Date("".concat(a," ").concat(t," ").concat(n));r.setHours(s),r.setMinutes(c),r.setSeconds(o);const i=(r=r.toString()).substr(0,10),l=r.substr(15,6);return"".concat(i," at ").concat(l)}(r.last_message.created)):"Say hello!")),s.a.createElement(A.Col,{xs:2,sm:0,style:Object(m.a)(Object(m.a)({},xe.mobileOptiom),{right:"6px"}),className:"ce-chat-settings-mobile-option"},s.a.createElement(ge,null)))},xe={titleSection:{position:"absolute",top:"0px",width:"100%",zIndex:"1",backgroundColor:"rgb(256, 256, 256, 0.92)"},mobileOptiom:{width:"100%",top:"32px",textAlign:"center",color:"rgb(24, 144, 255)",overflow:"hidden"},titleContainer:{width:"100%",padding:"18px 0px",textAlign:"center",color:"rgb(24, 144, 255)"},titleText:{fontSize:"24px",fontWeight:"600"},subtitleText:{fontSize:"12px"}},ve=()=>s.a.createElement("div",{style:{height:"100%",textAlign:"center"}},s.a.createElement("div",{style:{width:"100%"}},s.a.createElement("img",{style:{width:"40%",paddingTop:"25vh"},src:"https://chat-engine-assets.s3.amazonaws.com/denied.svg",alt:"welcome-to-chat-engine"})),s.a.createElement("div",{style:{fontSize:"18px",paddingTop:"24px",width:"75%",paddingLeft:"12.5%"}},"Your credentials are incorrect. Make sure your Public Key, Username, and Password are correct at ",s.a.createElement("a",{href:"https://chatengine.io"},"chatengine.io"))),Ee=()=>s.a.createElement("div",{style:{zIndex:"1",bottom:"66px",left:"calc(50% - 78px)",position:"absolute",fontSize:"15px",padding:"10px 22px",color:"white",backgroundColor:"#fa8c16",borderRadius:"1.3em"},id:"ce-connecting-popup"},s.a.createElement(j.a,{spin:!0})," ","Connecting"),ye=()=>s.a.createElement("div",{style:{height:"100%",textAlign:"center"}},s.a.createElement("div",{style:{width:"100%"}},s.a.createElement("img",{style:{width:"60%",paddingTop:"33vh"},src:"https://chat-engine-assets.s3.amazonaws.com/welcome.svg",alt:"welcome-to-chat-engine"})),s.a.createElement("div",{style:{fontSize:"18px",paddingTop:"24px",width:"75%",paddingLeft:"12.5%"}},'Fill out the "New Chat" form to get started.')),Ce=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Oe=["st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"],je=e=>{function t(e){return e?e.substr(0,10):null}const a=e.lastCreated,n=e.created,c=t(a),o=t(n);return a&&c===o?s.a.createElement("div",null):s.a.createElement("div",{style:we.dateText,className:"ce-message-date-text"},function(e){if(!e)return"";const t=e.substr(0,4),a=Ce[parseInt(e.substr(5,2))-1],n=e.substr(8,2),s=Oe[parseInt(e.substr(8,2))-1];var c=e.substr(11,5),o="";return parseInt(c.substr(0,2))>=12?(parseInt(c.substr(0,2))>12&&(c=String(parseInt(c.substr(0,2))-12)+":"+c.substr(3,2)),o="PM"):o="AM",c+o+", "+a+" "+n+s+", "+t}(n))},we={dateText:{width:"100%",textAlign:"center",paddingTop:"4px",paddingBottom:"10px",fontSize:"15px",color:"rgba(0, 0, 0, .40)"}},Se=e=>{const t=e.attachment;return t?s.a.createElement("img",{style:_e.thumbnail,src:t.file,alt:"thumb-nail"}):s.a.createElement("div",{style:_e.loadingContainer},s.a.createElement(w.a,{style:{color:"white",padding:"4px",fontSize:"28px"}}))},_e={loadingContainer:{width:"100%",cursor:"pointer",textAlign:"right",display:"inline-block",objectFit:"cover",borderRadius:"0.3em",marginRight:"2px",height:"30vw",width:"30vw",maxHeight:"200px",maxWidth:"200px",minHeight:"100px",minWidth:"100px",backgroundColor:"#d9d9d9"},thumbnail:{width:"100%",cursor:"pointer",textAlign:"right",display:"inline",objectFit:"cover",borderRadius:"0.3em",paddingRight:"2px",height:"30vw",width:"30vw",maxHeight:"200px",maxWidth:"200px",minHeight:"100px",minWidth:"100px"}},Ne=["#D64045","#5B3000","#00CC99","#467599","#1D3354","#8F250C","#6153CC","#961D4E","#A29F15","#0CAADC","#FF5154","#FA7921","#688E26","#550527","#A10702","#FF1053","#6C6EA0","#100B00"];function ke(e){return e?Ne[function(e){let t=0;for(var a=0;a<e.length;a++)t=t+e.charCodeAt(a)*a-97;return t}(e)%Ne.length]:"black"}class Me extends n.Component{constructor(...e){super(...e),this.state={avatar:""}}updateImg(){let e=this.props.avatar;e=e&&null!==e?e:"",e.split("?")[0]!==this.state.avatar.split("?")[0]&&this.setState({avatar:e})}componentDidMount(){this.updateImg()}componentDidUpdate(){this.updateImg()}render(){const e=ke(this.props.username),t=this.props.style?this.props.style:{};return s.a.createElement("div",{className:"ce-avatar-dot",style:Object(m.a)(Object(m.a)(Object(m.a)({},Ie.dot),t),{backgroundColor:this.state.avatar?"white":e,backgroundImage:this.state.avatar&&"url(".concat(this.state.avatar,")"),backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"14px"})})}}const Ie={dot:{width:"13px",height:"13px",borderRadius:"13px",textAlign:"center"}};Object(A.setConfiguration)({maxScreenClass:"xl"});const De=e=>{const t=e.lastMessage,a=e.message,n=e.nextMessage;if(!a)return s.a.createElement("div",null);const c=a&&a.attachments&&a.attachments,o=t&&t.sender_username===a.sender_username?"0.3em":"1.3em",r=n&&n.sender_username===a.sender_username?"0.3em":"1.3em",i="1.3em ".concat(o," ").concat(r," 1.3em"),l=n&&n.sender_username===a.sender_username?"2px":"12px";return s.a.createElement("div",{className:"ce-message-row ce-my-message",style:{width:"100%",textAlign:"right",paddingBottom:l}},s.a.createElement("div",{style:{display:"auto"},className:"ce-my-message-attachments-container"},function(){const t=e.message;return(t&&t.attachments?t.attachments:[]).map((e,t)=>s.a.createElement(Se,{attachment:e,key:"attachment_".concat(t)}))}()),s.a.createElement(A.Row,{style:{paddingRight:"2px"},className:"ce-message-bubble-row ce-my-message-bubble-row"},s.a.createElement(A.Col,{xs:1,sm:2,md:3}),s.a.createElement(A.Col,{xs:11,sm:10,md:9},!c||a.text&&s.a.createElement("div",{className:"ce-message-bubble ce-my-message-bubble",style:Object(m.a)(Object(m.a)({},Ae.myMessage),{borderRadius:i})},a.text)),s.a.createElement(A.Col,{xs:1,sm:2,md:3}),s.a.createElement(A.Col,{xs:12,className:"ce-reads-row ce-my-reads-row"},function(){const t=e.chat,a=e.message;return t?t.people.map((e,t)=>a.id===e.last_read?s.a.createElement(Me,{key:"read_".concat(t),avatar:e.person.avatar,username:e.person.username,style:{float:"right",marginLeft:"4px"}}):s.a.createElement("div",{key:"read_".concat(t)})):s.a.createElement("div",null)}())))},Ae={myMessage:{color:"white",cursor:"pointer",float:"right",textAlign:"left",padding:"12px",fontSize:"15px",whiteSpace:"pre-line",backgroundColor:"rgb(24, 144, 255)"}};Object(A.setConfiguration)({maxScreenClass:"xl"});const Te=e=>{const t=e.lastMessage,a=e.message,n=e.nextMessage;if(!a)return s.a.createElement("div",null);const c=a&&a.attachments&&a.attachments,o=t&&t.sender_username===a.sender_username?"0.3em":"1.3em",r=n&&n.sender_username===a.sender_username?"0.3em":"1.3em",i="".concat(o," 1.3em 1.3em ").concat(r),l=n&&n.sender_username===a.sender_username?"2px":"12px";return s.a.createElement("div",{style:{width:"100%",paddingBottom:l},className:"ce-message-row ce-their-message"},(!t||t.sender_username!==a.sender_username)&&s.a.createElement("div",{style:Re.nameText,className:"ce-their-message-sender"},a.sender_username),s.a.createElement(A.Row,{style:{paddingLeft:"2px"},className:"ce-their-message-row"},s.a.createElement(A.Col,{xs:11,sm:10,md:9},s.a.createElement("div",{style:{height:"0px"},className:"ce-their-message-avatar"},(!n||n.sender_username!==a.sender_username)&&s.a.createElement(Ze,{show_online:!1,username:a.sender_username,avatar:a.sender&&a.sender.avatar})),s.a.createElement("div",{style:{display:"auto",paddingLeft:"50px"},className:"ce-their-message-attachments-container"},function(){const t=e.message;return(t&&t.attachments?e.message.attachments:[]).map((e,t)=>s.a.createElement(Se,{attachment:e,key:"attachment_".concat(t)}))}()),!c||a.text&&s.a.createElement("div",{style:{paddingLeft:"48px"}},s.a.createElement("div",{className:"ce-message-bubble ce-their-message-bubble",style:Object(m.a)(Object(m.a)({},Re.theirMessage),{borderRadius:i})},a.text))),s.a.createElement(A.Col,{xs:9,style:{marginLeft:"48px"},className:"ce-reads-row ce-their-reads-row"},function(){const t=e.chat,a=e.message;return t?t.people.map((e,t)=>a.id===e.last_read?s.a.createElement(Me,{key:"read_".concat(t),avatar:e.person.avatar,username:e.person.username,style:{float:"left",marginLeft:"4px"}}):s.a.createElement("div",{key:"read_".concat(t)})):s.a.createElement("div",null)}())))},Re={theirMessage:{cusor:"auto",color:"black",float:"left",padding:"12px",fontSize:"15px",whiteSpace:"pre-line",backgroundColor:"#f1f0f0"},nameText:{paddingLeft:"62px",paddingBottom:"2px",color:"rgba(0, 0, 0, .40)",fontSize:"15px"}};Object(A.setConfiguration)({maxScreenClass:"xl"});const ze=e=>{const t=e.lastMessage,a=e.message,n=e.nextMessage;if(!a)return s.a.createElement("div",null);const c=a&&a.attachments?a.attachments:[],o=t&&t.sender_username===a.sender_username?"0.3em":"1.3em",r=n&&n.sender_username===a.sender_username?"0.3em":"1.3em",i="1.3em ".concat(o," ").concat(r," 1.3em"),l=n&&n.sender_username===a.sender_username?"2px":"12px";return s.a.createElement("div",{className:"ce-message-row ce-my-message ce-my-message-sending",style:{width:"100%",textAlign:"right",paddingBottom:l}},s.a.createElement("div",{style:{display:"auto"},className:"ce-my-message-attachments-container"},function(e){return e.map((e,t)=>s.a.createElement(Se,{key:"sending-file-".concat(t)}))}(c)),s.a.createElement(A.Row,{style:{paddingRight:"2px"},className:"ce-message-bubble-row ce-my-message-bubble-row ce-my-message-sending-row"},s.a.createElement(A.Col,{xs:1,sm:2,md:3}),s.a.createElement(A.Col,{xs:11,sm:10,md:9},a.text&&s.a.createElement("div",{className:"ce-message-bubble ce-my-message-bubble",style:Object(m.a)(Object(m.a)({},Fe.myMessage),{borderRadius:i})},a.text)),s.a.createElement(A.Col,{xs:1,sm:2,md:3})))},Fe={myMessage:{color:"white",cursor:"pointer",float:"right",textAlign:"left",padding:"12px",fontSize:"15px",whiteSpace:"pre-line",backgroundColor:"#40a9ff"}},Le=e=>{const t=e.lastMessage,a=e.message,c=e.nextMessage,o=e.sending,r=e.chat,i=Object(n.useContext)(R).conn;return a&&r?s.a.createElement("div",{className:"ce-message-and-date"},!o&&s.a.createElement(je,{lastCreated:t?t.created:null,created:a.created}),o?s.a.createElement(ze,{chat:r,conn:i,lastMessage:t,message:a,nextMessage:c}):s.a.createElement("div",null,a.sender_username===i.userName||a.sender_username===i.senderUsername?s.a.createElement(De,{chat:r,conn:i,lastMessage:t,message:a,nextMessage:c}):s.a.createElement(Te,{chat:r,conn:i,lastMessage:t,message:a,nextMessage:c}))):s.a.createElement("div",null)},Pe=e=>{const t=Object(n.useState)(!1),a=Object(h.a)(t,2),c=a[0],o=a[1];return s.a.createElement("div",{style:{padding:"12px 6px",display:"inline"},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1)},s.a.createElement("img",{style:Be.imageSquare,alt:e.file?e.file.name:"",src:URL.createObjectURL(e.file)}),c&&s.a.createElement(S.a,{style:Be.closeIcon,onClick:()=>e.onRemove&&e.onRemove()}))},Be={imageSquare:{height:"108px",width:"108px",border:"1px solid #afafaf",borderRadius:"8px",objectFit:"cover",display:"inline"},closeIcon:{position:"relative",bottom:"91px",right:"20px",width:"0px",cursor:"pointer"}},Ke=e=>s.a.createElement("div",{style:{width:"calc(100% - 24px)",paddingLeft:"12px"}},e.files.map((t,a)=>s.a.createElement(Pe,{file:t,key:"thumb_".concat(a),onRemove:()=>e.onRemove&&e.onRemove(a)}))),Ue=e=>{const t=Object(n.useState)({hovered:!1,files:[]}),a=Object(h.a)(t,2),c=a[0],o=a[1];return s.a.createElement("form",{className:"uploader",encType:"multipart/form-data",style:{height:"0px"}},s.a.createElement("label",{htmlFor:"files",id:"upload-document-button"},s.a.createElement(N.a,{onMouseEnter:()=>o(Object(m.a)(Object(m.a)({},c),{},{hovered:!0})),onMouseLeave:()=>o(Object(m.a)(Object(m.a)({},c),{},{hovered:!1})),style:Object(m.a)(Object(m.a)({},{cursor:"pointer",position:"absolute",bottom:"20px",right:"63px",fontSize:"18px"}),{color:c.hovered?"#69c0ff":"#1890ff"})})),s.a.createElement("input",{multiple:!0,id:"files",accept:"image/x-png,image/gif,image/jpeg",style:{visibility:"hidden"},type:"file",onChange:t=>function(t){let a=[];[...Array(t.target.files.length).keys()].map((e,n)=>{const s=t.target.files[n];s&&a.push(s)}),e.onSelectFiles&&e.onSelectFiles(a)}(t)}))},We=()=>{const e=Object(n.useContext)(R),t=e.conn,a=e.activeChat,c=e.sendingMessages,o=e.setSendingMessages,r=Object(n.useState)({trigger:0,mod:3,value:"",attachments:[]}),i=Object(h.a)(r,2),l=i[0],d=i[1];function p(e){e.preventDefault();const n=l.attachments,s=l.value.trim(),r={text:s,attachments:n,custom_json:{sender_id:Date.now().toString()},sender_username:t.userName?t.userName:t.senderUsername,chat:a};(s.length>0||n.length>0)&&function(e,t,a,n){let s=new FormData;if(a.attachments)for(let c=0;c<a.attachments.length;c++)s.append("attachments",a.attachments[c],a.attachments[c].name);else if(a.files)for(let c=0;c<a.files.length;c++)s.append("attachments",a.files[c],a.files[c].name);s.append("text",a.text),s.append("sender_username",a.sender_username),s.append("custom_json",JSON.stringify(a.custom_json?a.custom_json:{})),f.a.post("".concat(F(e),"/chats/").concat(t,"/messages/"),s,{headers:L(e)}).then(e=>{n&&n(e.data)}).catch(e=>{console.log("Send Messages Error",e)})}(t,a,r,e=>{}),d(Object(m.a)(Object(m.a)({},l),{},{value:"",attachments:[]}));let i=Object(m.a)({},c);i[r.custom_json.sender_id]=r,o(i)}return s.a.createElement("div",{id:"msg-form-container",style:Ge.NewMessageFormContainer,className:"ce-message-form-container"},s.a.createElement(Ke,{files:l.attachments,onRemove:e=>function(e){let t=l.attachments;t.splice(e,1),d(Object(m.a)(Object(m.a)({},l),{},{attachments:t}))}(e)}),s.a.createElement(Ue,{onSelectFiles:e=>d(Object(m.a)(Object(m.a)({},l),{},{attachments:e}))}),s.a.createElement("form",{onSubmit:p.bind(void 0),className:"ce-message-form"},s.a.createElement("div",{style:Ge.inputContainer,className:"ce-message-input-form"},s.a.createElement(st,{value:l.value,label:"Send a message...",handleChange:function(e){var n,s,c;d(Object(m.a)(Object(m.a)({},l),{},{value:e.target.value,trigger:(l.trigger+1)%l.mod})),1===l.trigger&&(n=t,s=a,f.a.post("".concat(F(n),"/chats/").concat(s,"/typing/"),{},{headers:L(n)}).then(e=>{c&&c(e.data)}).catch(e=>{}))}.bind(void 0),onSubmit:p.bind(void 0)}),s.a.createElement(et,{icon:"send",type:"submit",style:{position:"absolute",bottom:"10px",right:"6px"}}))))},Ge={NewMessageFormContainer:{position:"absolute",bottom:"0px",width:"100%",backgroundColor:"white"},inputContainer:{minHeight:"36px",paddingTop:"10px",paddingBottom:"6px"}},He=e=>s.a.createElement("div",{style:{color:ke(e.username),padding:"2px",paddingLeft:"12px"}},"".concat(e.username," is typing...")),Je=e=>{const t=Object(n.useRef)(!1),a=Object(n.useState)(0),c=Object(h.a)(a,2),o=c[0],r=c[1],i=Object(n.useState)(null),l=Object(h.a)(i,2),d=l[0],p=l[1],u=Object(n.useContext)(R),b=u.connecting,f=u.conn,x=u.chats,v=u.setChats,E=u.sendingMessages,y=u.messages,C=u.setMessages,O=u.activeChat,j=u.setActiveChat,w=u.typingData,S=u.setTypingData,_=u.typingCounter,N=u.setTypingCounter;function k(t,a){if(C(g.a.mapKeys(a,"id")),a.length>0){const n=a[a.length-1];e.userName&&e.userName!==n.sender_username&&B(f,t,n.id,e=>function(e){if(x){const t=Object(m.a)({},x);t[e.id]=e,v(t)}}(e))}e.onGetMessages&&e.onGetMessages(t,a)}Object(n.useEffect)(()=>{f&&!e.activeChat&&null!==O&&O!==d?(p(O),P(f,O,(e,t)=>k(e,t))):f&&e.activeChat&&e.activeChat!==d&&(j(e.activeChat),p(e.activeChat),P(f,e.activeChat,(e,t)=>k(e,t)))},[f,O]),Object(n.useEffect)(()=>{if(_){const e=Object(m.a)({},_);Object.keys(e).map(t=>{Object.keys(e[t]).map(a=>{e[t][a]>0&&setTimeout(()=>{N(Object(m.a)(Object(m.a)({},e),{},{[t]:Object(m.a)(Object(m.a)({},e[t]),{},{[a]:e[t][a]-1})}))},2500)})})}},[_]),Object(n.useEffect)(()=>{t.current?(g.a.isEmpty(y)||T.animateScroll.scrollToBottom({duration:o,containerId:"ce-feed-container"}),Object.keys(_).map(e=>{let t=[];Object.keys(_[e]).map(a=>{_[e][a]>0&&t.push(a)}),w[e]&&w[e].length===t.length||S(Object(m.a)(Object(m.a)({},w),{},{[e]:t}))})):(t.current=!0,setTimeout(()=>{r(100)},3e3))});const M=x&&x[d];return void 0===f?s.a.createElement(ve,null):f&&null!==x&&g.a.isEmpty(x)?s.a.createElement(ye,null):s.a.createElement("div",{className:"ce-chat-feed",style:{height:"100%",maxHeight:"100vh",backgroundColor:"#f0f0f0"}},b&&s.a.createElement(Ee,null),e.renderChatHeader?e.renderChatHeader(M):s.a.createElement(fe,null),s.a.createElement("div",{id:"ce-feed-container",style:Ye.feedContainer,className:"ce-chat-feed-container"},s.a.createElement("div",{style:{height:"88px"},className:"ce-feed-container-top"}),function(){const t=x&&x[O],a=Object.keys(y);return a.map((n,c)=>{const o=y[n],r=0===c?null:a[c-1],i=c===a.length-1?null:a[c+1];return e.renderMessageBubble?s.a.createElement("div",{key:"message_".concat(c)},e.renderMessageBubble(f,t,y[r],o,y[i])):s.a.createElement(Le,{key:"message_".concat(c),chat:t,message:o,lastMessage:y[r],nextMessage:y[i]})})}(),function(){const e=Object.keys(E),t=x&&x[O];return e.map((a,n)=>{const c=E[a],o=0===n?null:e[n-1],r=n===e.length-1?null:e[n+1];if(c&&c.chat===O)return s.a.createElement(Le,{sending:!0,key:"sending-msg-".concat(n),chat:t,message:c,lastMessage:E[o],nextMessage:E[r]})})}(),function(){const t=w&&w[O]?w[O]:[];return e.renderIsTyping?e.renderIsTyping(t):t.map((e,t)=>s.a.createElement(He,{key:"typer_".concat(t),username:e}))}(),s.a.createElement("div",{style:{height:"54px"},className:"ce-feed-container-bottom"})),e.renderNewMessageForm?e.renderNewMessageForm(e,d):s.a.createElement(We,null))},Ye={feedContainer:{width:"100%",height:"100%",maxHeight:"100vh",overflowX:"hidden",overflowY:"scroll",backgroundColor:"white"}};Object(A.setConfiguration)({maxScreenClass:"xl",gutterWidth:0});const Xe=e=>{const t=Object(n.useContext)(R),a=e.height;return s.a.createElement("div",{style:{textAlign:"left",backgroundColor:"white"}},s.a.createElement(K,e),s.a.createElement(A.Row,null,s.a.createElement(A.Col,{xs:0,sm:3,style:{height:a||""}},e.renderChatList?e.renderChatList(Object(m.a)(Object(m.a)({},e),t)):s.a.createElement(q,e)),s.a.createElement(A.Col,{xs:12,sm:6,style:{height:a||""}},e.renderChatFeed?e.renderChatFeed(Object(m.a)(Object(m.a)({},e),t)):s.a.createElement(Je,e)),s.a.createElement(A.Col,{xs:0,sm:3,style:{height:a||""}},e.renderChatSettings?e.renderChatSettings(Object(m.a)(Object(m.a)({},e),t)):s.a.createElement(he,e))))},qe=e=>Object(n.useContext)(R)?s.a.createElement(Xe,e):s.a.createElement(z,null,s.a.createElement(Xe,e)),Ve=e=>{const t=Object(n.useContext)(R),a=t.setConnecting,c=t.conn,o=t.setConn,r=t.chats,i=t.setChats,l=t.messages,d=t.setMessages,p=t.sendingMessages,h=t.setSendingMessages,u=t.activeChat,g=t.setActiveChat,b=t.typingCounter,v=t.setTypingCounter;function E(t){if(r){const e=Object(m.a)({},r);e[t.id]=t,i(e)}e.onEditChat&&e.onEditChat(t)}function y(t){o(t),a(!1),function(e,t,a){f.a.get("".concat(F(e),"/chats/").concat(t,"/"),{headers:L(e)}).then(e=>{a&&a(e.data)}).catch(e=>{console.log("Get Chat Error",e)})}(t,e.chatID,e=>function(e){null===u&&g(e.id),i(_.mapKeys([e],"id"))}(e)),e.onConnect&&e.onConnect(t)}const C=e.development,O=e.publicKey,j=e.projectID,w=e.chatID,S=e.chatAccessKey,N=C?"ws://":"wss://",k=C?"127.0.0.1:8000":"api.chatengine.io",M=O||j;return s.a.createElement(x.a,{url:"".concat(N).concat(k,"/chat/?projectID=").concat(M,"&chatID=").concat(w,"&accessKey=").concat(S),onOpen:()=>y(e),onClose:function(){a(!0)}.bind(void 0),onMessage:function(t){const a=JSON.parse(t);if("login_error"===a.action)console.log("Your chat auth credentials were not correct: \n\n                Project ID: ".concat(e.projectID," \n\n                Chat ID: ").concat(e.chatID," \n\n                Access Key: ").concat(e.chatAccessKey,"\n\n                Double check these credentials to make sure they're correct.\n\n                If all three are correct, try resetting the username and secret in the Online Dashboard or Private API.")),o(void 0),e.onFailAuth&&e.onFailAuth(c);else if("edit_chat"===a.action)E(a.data);else if("delete_chat"===a.action){const t=a.data;r&&(r[t.id]=void 0,i(r)),e.onDeleteChat&&e.onDeleteChat(t)}else if("add_person"===a.action)E(a.data),e.onAddPerson&&e.onAddPerson(a.data);else if("remove_person"===a.action)E(a.data),e.onRemovePerson&&e.onRemovePerson(a.data);else if("new_message"===a.action){const t=a.data,n=t.id,s=t.message;if("string"===typeof s.custom_json&&-1!==s.custom_json.indexOf("sender_id")&&(p[JSON.parse(s.custom_json).sender_id]=void 0,h(p)),n===u){const e=Object(m.a)({},l);e[s.id]=s,d(e)}e.onNewMessage&&e.onNewMessage(n,s)}else if("edit_message"===a.action){const t=a.data,n=t.id,s=t.message;n===u&&(l[s.id]=s,d(l)),e.onEditMessage&&e.onEditMessage(n,s)}else if("delete_message"===a.action){const t=a.data,n=t.id,s=t.message;n===u&&(l[s.id]=void 0,d(l)),e.onDeleteMessage&&e.onDeleteMessage(n,s)}else if("is_typing"===a.action){const t=a.data,n=t.id,s=t.person;let c=Object(m.a)({},b);c=c[n]&&c[n][s]?Object(m.a)(Object(m.a)({},c),{},{[n]:Object(m.a)(Object(m.a)({},c[n]),{},{[s]:c[n][s]+1})}):Object(m.a)(Object(m.a)({},c),{},{[n]:Object(m.a)(Object(m.a)({},c[n]),{},{[s]:1})}),v(c),e.onTyping&&e.onTyping(n,s)}}.bind(void 0),reconnectIntervalInMilliSeconds:3e3})};function Qe(e,t,a,n){f.a.post("".concat(F(e),"/chats/").concat(t,"/people/"),{username:a},{headers:L(e)}).then(e=>{n&&n(e.data)}).catch(e=>{console.log("New Person Error",e)})}class Ze extends n.Component{constructor(...e){super(...e),this.state={avatar:""}}updateImg(){let e=this.props.avatar;e=e&&null!==e?e:"",e.split("?")[0]!==this.state.avatar.split("?")[0]&&this.setState({avatar:e})}componentDidMount(){this.updateImg()}componentDidUpdate(){this.updateImg()}render(){const e=this.props,t=e.username,a=e.is_online,n=this.props.style?this.props.style:{},c=t?t.substring(0,2).toUpperCase():"",o=ke(t);return s.a.createElement("div",{style:{width:"48px",height:"48px"}},s.a.createElement("div",{style:{height:"0px"}},s.a.createElement("div",{className:"ce-avatar",style:Object(m.a)(Object(m.a)(Object(m.a)({},$e.avatar),n),{backgroundColor:this.state.avatar?"white":o,backgroundImage:this.state.avatar&&"url(".concat(this.state.avatar,")"),backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"48px"})},s.a.createElement("div",{className:"ce-avatar-text",style:$e.avatarText},!this.state.avatar&&c))),!1!==this.props.show_online&&s.a.createElement("div",{className:"ce-avatar-status",style:Object(m.a)(Object(m.a)({},$e.status),{backgroundColor:a?"#52c41a":"#f5222d"})}))}}const $e={avatar:{width:"44px",height:"44px",borderRadius:"22px",color:"white",textAlign:"center"},avatarText:{color:"white",paddingTop:"12px",fontSize:"15px",fontWeight:"600"},status:{width:"8px",height:"8px",borderRadius:"100%",border:"2px solid white"}};class et extends n.Component{constructor(...e){super(...e),this.state={hovered:!1}}render(){const e=this.props,t=e.value,a=e.icon,n=e.theme,c=e.style,o=c||{},r=this.state.hovered?tt.hoverButton:{},i="danger"===n?tt.dangerButton:tt.button;return s.a.createElement("button",{type:this.props.type,onClick:()=>this.props.onClick&&this.props.onClick(),onMouseEnter:()=>this.setState({hovered:!0}),onMouseLeave:()=>this.setState({hovered:!1}),style:Object(m.a)(Object(m.a)(Object(m.a)({},i),o),r),className:"ce-primary-button ".concat("danger"===n?"ce-danger-button":"")},"plus"===a&&s.a.createElement(k.a,null),"send"===a&&s.a.createElement(M.a,null),"delete"===a&&s.a.createElement(I.a,null),"user-add"===a&&s.a.createElement(D.a,null),t&&a?" ".concat(t):t)}}const tt={button:{color:"white",border:"none",outline:"none",height:"36px",fontSize:"15px",cursor:"pointer",padding:"8px 16px",borderRadius:"33px",backgroundColor:"#1890ff"},dangerButton:{color:"red",border:"none",outline:"none",height:"36px",fontSize:"15px",cursor:"pointer",padding:"8px 16px",borderRadius:"33px",backgroundColor:"white",border:"1px solid red"},hoverButton:{opacity:"0.66"}};class at extends n.Component{constructor(...e){super(...e),this.state={focused:!1,value:null}}componentDidMount(){const e=this.props.default;if(e){const t={target:{value:e}};this.props.handleChange(t),this.setState({value:e})}}render(){const e=this.props.style?this.props.style:{},t=this.state.focused?nt.focusInput:nt.input;return s.a.createElement("input",{className:"ce-input ce-text-input",value:this.props.value,placeholder:this.props.label,style:Object(m.a)(Object(m.a)({},t),e),onBlur:()=>this.setState({focused:!1}),onFocus:()=>this.setState({focused:!0}),type:this.props.type?this.props.type:"text",onChange:e=>this.props.handleChange&&this.props.handleChange(e)})}}const nt={input:{height:"36px",fontSize:"15px",outline:"none",borderRadius:"24px",border:"1px solid #d9d9d9",padding:"0px 12px",boxSizing:"border-box"},focusInput:{height:"36px",fontSize:"15px",outline:"none",borderRadius:"24px",border:"1px solid #1890ff",padding:"0px 12px",boxSizing:"border-box"}};class st extends n.Component{constructor(...e){super(...e),this.state={focused:!1,value:null}}componentDidMount(){const e=this.props.default;e&&(this.props.handleChange({target:{value:e}}),this.setState({value:e}))}resize(){var e=document.getElementById("msg-textarea");e.style.height="",e.style.height=Math.min(e.scrollHeight,150)+"px"}componentDidMount(){this.resize()}handleChange(e){this.resize(),this.props.handleChange&&this.props.handleChange(e)}onKeyDown(e){"Enter"===e.key&&(e.preventDefault(),this.props.value.length>0&&this.props.onSubmit&&this.props.onSubmit(e))}render(){return s.a.createElement("textarea",{id:"msg-textarea",className:"ce-input ce-textarea-input",rows:"1",style:ct.input,value:this.props.value,placeholder:this.props.label,onBlur:()=>this.setState({focused:!1}),onFocus:()=>this.setState({focused:!0}),type:this.props.type?this.props.type:"text",onChange:e=>this.handleChange(e),onKeyDown:e=>this.onKeyDown(e)})}}const ct={input:{border:"1px solid white",width:"calc(100% - 64px - 24px - 44px)",outline:"none",fontFamily:"inherit",fontSize:"15px",paddingLeft:"12px",paddingRight:"12px",position:"relative",left:"12px",resize:"none"}};class ot extends n.Component{constructor(...e){super(...e),this.state={focused:!1,showAll:!1}}onFocus(){this.onChange("",!0),this.setState({focused:!0}),this.props.onFocus&&this.props.onFocus()}onBlur(){this.setState({focused:!1}),this.props.onBlur&&this.props.onBlur()}onChange(e,t){this.setState({showAll:t}),this.props.handleChange&&this.props.handleChange(e)}getNames(){let e=0;const t=this.props.max?this.props.max:3,a=[];return this.props.options.map(n=>{-1!==JSON.stringify(n).toLowerCase().indexOf(this.props.value.toLowerCase())&&e<t&&(e+=1,a.push(n))}),a}renderOptions(){if(!this.props.value&&!this.state.showAll)return s.a.createElement("div",null);const e=this.getNames();return e.map((t,a)=>s.a.createElement("div",{key:"option_".concat(a),className:"ce-autocomplete-option"},this.props.renderOption&&this.props.renderOption(t),a===e.length-1&&s.a.createElement("div",{style:rt.close,className:"ce-autocomplete-close",onClick:()=>this.onChange("",!1)},s.a.createElement(E.a,null))))}render(){const e=this.props.options,t=this.props.style?this.props.style:{},a=Object(m.a)(Object(m.a)({},rt.input),{border:this.state.focused?"1px solid #1890ff":"1px solid #d9d9d9"});return s.a.createElement("div",null,s.a.createElement("input",{className:"ce-input ce-autocomplete-input",value:this.props.value,placeholder:this.props.label,style:Object(m.a)(Object(m.a)({},a),t),type:this.props.type?this.props.type:"text",onBlur:()=>this.onBlur(),onFocus:()=>this.onFocus(),onChange:e=>this.onChange(e.target.value,!0)}),e&&e.length>0&&this.state.showAll&&s.a.createElement("div",{className:"ce-autocomplete-options",style:{borderRadius:"19px",border:"1px solid #afafaf",overflow:"hidden"}},this.props.options&&this.renderOptions()))}}const rt={input:{height:"36px",fontSize:"15px",outline:"none",borderRadius:"24px",padding:"0px 12px",boxSizing:"border-box"},close:{cursor:"pointer",textAlign:"center",padding:"8px 12px",fontSize:"15px",borderRadius:"24px"}};var it=a(30);Object(it.setConfiguration)({maxScreenClass:"xl",gutterWidth:0});class lt extends n.Component{constructor(...e){super(...e),this.state={loading:!1,c:null}}render(){return s.a.createElement(it.Row,null,s.a.createElement(it.Col,{xs:12,sm:6,md:4,style:{height:"600px"}},s.a.createElement(z,null,s.a.createElement(Ve,{development:!0,projectID:"1ed59673-1fd6-46ed-9eb9-56239a6a4f82",chatID:251,chatAccessKey:"ca-0d21f8cb-b884-4a8b-9e2e-a2acbdbc3792",senderUsername:"Adam La Morre"}),s.a.createElement(Je,{development:!0,projectID:"1ed59673-1fd6-46ed-9eb9-56239a6a4f82",chatID:251,chatAccessKey:"ca-0d21f8cb-b884-4a8b-9e2e-a2acbdbc3792",activeChat:251,senderUsername:"Adam La Morre"}))))}}class dt extends n.Component{constructor(...e){super(...e),this.state={username:""}}createDirectChat(e){U(e,{is_direct_chat:!0},t=>Qe(e,t.id,this.state.username))}renderChatForm(e){return s.a.createElement("div",null,s.a.createElement("input",{placeholder:"Username",value:this.state.username,onChange:e=>this.setState({username:e.target.value})}),s.a.createElement("button",{onClick:()=>this.createDirectChat(e)},"Chat"))}render(){return s.a.createElement("div",{style:{position:"absolute",top:"0px",width:"100%"}},s.a.createElement(qe,{height:"100vh",userName:"Adam_La_Morre",userSecret:"pass1234",projectID:"1ed59673-1fd6-46ed-9eb9-56239a6a4f82",renderNewChatForm:e=>this.renderChatForm(e)}))}}var pt=a(99),mt=a.n(pt);const ht=(e,t,a)=>n=>{mt.a.get("".concat(e.rootUrl,"users/me/"),{headers:{"Project-ID":e.projectID,"User-Name":e.userName,"User-Secret":e.userSecret}}).then(a=>{t&&t(a),n({type:"SIGN_IN_OK",payload:e})}).catch(e=>{a&&a(e)})},ut=()=>e=>{e({type:"SIGN_OUT"})};var gt=a(52),bt=a.n(gt);var ft=e=>{const t=Object(n.useContext)(R),a=t.chats,c=t.messages,o=t.setActiveChat,r=Object(n.useState)(!1),i=Object(h.a)(r,2),l=i[0],d=i[1];return Object(n.useEffect)(()=>{const t=e.id;t&&a&&a[t]&&!bt.a.isEmpty(c)&&!l&&(o(t),d(!0))},[a,c,e,o,l,d]),s.a.createElement(qe,{height:"100vh",development:!e.prod,userName:e.userName,userSecret:e.userSecret,projectID:e.projectID})};const xt=-1!==window.location.host.indexOf("chatengine.io");var vt=Object(r.b)((function(e){return{accounts:e.accounts}}),(function(e){return Object(l.b)({login:ht,logout:ut},e)}))(e=>{const t=Object(n.useState)({loading:!1,rootUrl:xt?"https://api.chatengine.io/":"http://127.0.0.1:8000/",projectID:xt?"8a1f9edb-a05a-4b55-9d6e-ec399a38f5a9":"1ed59673-1fd6-46ed-9eb9-56239a6a4f82",userName:"",userSecret:""}),a=Object(h.a)(t,2),c=a[0],o=a[1],r=e.match.params.id;return e.accounts.userName?s.a.createElement("div",{style:{position:"absolute",top:"0px",width:"100%"}},s.a.createElement(z,null,s.a.createElement(ft,Object.assign({},e.accounts,xt,{id:parseInt(r)}))),s.a.createElement("button",{onClick:()=>e.logout(),style:{position:"absolute",bottom:"24px",right:"24px"}},"Logout!")):s.a.createElement("div",null,s.a.createElement("input",{type:"text",placeholder:"User Name",onChange:e=>o(Object(m.a)(Object(m.a)({},c),{},{userName:e.target.value}))}),s.a.createElement("input",{type:"password",placeholder:"Password",onChange:e=>o(Object(m.a)(Object(m.a)({},c),{},{userSecret:e.target.value}))}),s.a.createElement("button",{onClick:()=>(o(Object(m.a)(Object(m.a)({},c),{},{loading:!0})),void e.login(c,()=>{},e=>console.log(e))),style:{backgroundColor:c.loading?"#f0f0f0":"#91d5ff"}},"Submit"))});class Et extends n.Component{render(){return s.a.createElement(i.b,{history:p},s.a.createElement(i.c,null,s.a.createElement(i.a,{path:"/with_me",component:lt}),s.a.createElement(i.a,{path:"/direct",component:dt}),s.a.createElement(i.a,{path:"/:id",component:vt}),s.a.createElement(i.a,{path:"/",component:vt})))}}var yt=Object(r.b)((function(e){return{accounts:e.accounts}}),(function(e){return Object(l.b)({},e)}))(Et),Ct=a(100),Ot=a(101),jt=a.n(Ot);const wt={};var St=a(274),_t=Object(l.c)({accounts:function(e=wt,t){switch(t.type){case"SIGN_IN_OK":return Object(m.a)({},t.payload);case"SIGN_OUT":return wt;default:return e}},form:St.a}),Nt=a(104),kt=a.n(Nt),Mt=a(58),It=a(105);const Dt={key:"2",storage:kt.a},At=Object(Mt.a)(Dt,_t),Tt=Object(l.a)(jt.a,Ct.a)(l.d)(At),Rt=Object(Mt.b)(Tt,{},()=>{});var zt=function(){return s.a.createElement(r.a,{store:Tt},s.a.createElement(It.a,{loading:null,persistor:Rt},s.a.createElement(yt,null)))};o.a.render(s.a.createElement(zt,null),document.getElementById("root"))}},[[106,1,2]]]);
//# sourceMappingURL=main.cc70ee64.chunk.js.map